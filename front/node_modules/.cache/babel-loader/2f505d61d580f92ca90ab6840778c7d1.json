{"ast":null,"code":"import { bus } from '@/event-bus';\nexport default {\n  name: 'RotatorAuth',\n  data() {\n    return {\n      login_loading: false,\n      is_admin: 0,\n      // process.env.NODE_ENV === 'development',\n      login: '',\n      password: '',\n      err_input_login: false,\n      err_input_password: false\n    };\n  },\n  watch: {\n    /*is_admin(val) {\n      bus.$emit('is_admin', val ? 1 : 0)\n    }*/\n  },\n  methods: {\n    send() {\n      this.login_loading = true;\n      console.log(this.login.length);\n      if (this.login.length == 0 || this.password.length == 0) {\n        if (this.login.length == 0) {\n          this.err_input_login = true;\n        } else {\n          this.err_input_login = false;\n        }\n        if (this.password.length == 0) {\n          this.err_input_password = true;\n        } else {\n          this.err_input_password = false;\n        }\n        this.login_loading = false;\n        return -1;\n      }\n      this.err_input_login = false;\n      this.err_input_password = false;\n\n      // eslint-disable-next-line\n      //console.log(this.color_data);\n      this.$ajax.post('/api/v1/users/auth', {\n        login: this.login,\n        password: this.password,\n        key: localStorage.getItem('rotator_client_id')\n      }).then(function (data) {\n        // eslint-disable-next-line\n        console.log(data);\n        if (data.data.role === 'admin') {\n          this.is_admin = true;\n          bus.$emit('is_admin', 1);\n          bus.$emit('close_dialogs');\n        }\n        this.login_loading = false;\n      }.bind(this)).catch(error => {\n        // eslint-disable-next-line\n        console.log(error);\n      });\n    },\n    checkadmin() {\n      if (localStorage.getItem('rotator_client_id') != null) {\n        this.$ajax.post('/api/v1/users/whoami', {\n          key: localStorage.getItem('rotator_client_id')\n        }).then(function (data) {\n          if (data.data.role == \"admin\") {\n            this.is_admin = true;\n            bus.$emit('is_admin', 1);\n            bus.$emit('close_dialogs');\n          }\n        }.bind(this)).catch(error => {\n          // eslint-disable-next-line\n          console.log(error);\n        });\n      }\n    }\n  },\n  created() {\n    this.checkadmin();\n    bus.$emit('is_admin', this.is_admin ? 1 : 0);\n    bus.$on('get_admin', () => {\n      bus.$emit('is_admin', this.is_admin ? 1 : 0);\n    });\n    //setInterval(() => this.checkadmin(),10000)\n  }\n};","map":null,"metadata":{},"sourceType":"module"}